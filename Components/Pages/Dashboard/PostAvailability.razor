@page "/post-availability"
@inject NavigationManager Navigation
@using t12Project.Components.Pages.Dashboard.PostAvailabilityComponents

<PageTitle>Post Availability - LoadHitch</PageTitle>

<div class="min-h-screen bg-white">
	<!-- Header -->
	<div class="bg-gradient-to-r from-teal-600 to-blue-600 text-white">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
			<div class="flex items-center justify-between">
				<div class="flex items-center gap-4">
					<button @onclick="GoBack" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
						<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
						</svg>
					</button>
					<h1 class="text-2xl font-bold">Post Availability</h1>
				</div>
			</div>
		</div>
	</div>

	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8">
		<div class="grid lg:grid-cols-5 gap-6 lg:gap-8">
			<!-- Main Content - Left Side -->
			<div class="lg:col-span-3">
				<!-- User Type Selector -->
				<div class="mb-6 sm:mb-8">
					<div class="flex gap-2 sm:gap-3 p-1 bg-gray-100 rounded-xl sm:rounded-2xl">
						<button
							@onclick="() => SetUserType(UserType.Driver)"
							class="flex-1 px-3 sm:px-6 py-3 sm:py-4 rounded-lg sm:rounded-xl font-semibold transition-all whitespace-nowrap text-sm sm:text-base @(currentUserType == UserType.Driver ? "bg-white text-gray-900 shadow-md" : "text-gray-600 hover:text-gray-900")">
							<div class="flex items-center justify-center gap-1 sm:gap-2">
								<span class="text-lg sm:text-xl">ðŸš›</span>
								<span class="hidden sm:inline">Post Truck Availability</span>
								<span class="sm:hidden">Truck</span>
							</div>
						</button>
						<button
							@onclick="() => SetUserType(UserType.Shipper)"
							class="flex-1 px-3 sm:px-6 py-3 sm:py-4 rounded-lg sm:rounded-xl font-semibold transition-all whitespace-nowrap text-sm sm:text-base @(currentUserType == UserType.Shipper ? "bg-white text-gray-900 shadow-md" : "text-gray-600 hover:text-gray-900")">
							<div class="flex items-center justify-center gap-1 sm:gap-2">
								<span class="text-lg sm:text-xl">ðŸ“¦</span>
								<span class="hidden sm:inline">Post Load/Shipment</span>
								<span class="sm:hidden">Load</span>
							</div>
						</button>
					</div>
				</div>

				<!-- Step Indicator -->
				<div class="mb-6 sm:mb-8">
					<div class="flex items-center justify-between">
						@for (int i = 1; i <= 4; i++)
						{
							int stepNum = i;
							<div class="flex items-center flex-1">
								<div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center font-bold transition-all text-sm sm:text-base @(currentStep >= stepNum ? "bg-teal-600 text-white" : "bg-gray-200 text-gray-400")">
									@stepNum
								</div>
								@if (stepNum < 4)
								{
									<div class="flex-1 h-1 mx-1 sm:mx-2 transition-all @(currentStep > stepNum ? "bg-teal-600" : "bg-gray-200")"></div>
								}
							</div>
						}
					</div>
					<div class="flex justify-between mt-2 px-1">
						<span class="text-xs font-semibold text-gray-600">Route</span>
						<span class="text-xs font-semibold text-gray-600">Schedule</span>
						<span class="text-xs font-semibold text-gray-600">Type</span>
						<span class="text-xs font-semibold text-gray-600">Details</span>
					</div>
				</div>

				<!-- Step Content -->
				@if (currentStep == 1)
				{
					<RouteStep OnNext="() => currentStep = 2" 
							   UserType="(int)currentUserType"
							   Origin="@formData.Origin"
							   OriginChanged="v => formData.Origin = v"
							   Destination="@formData.Destination"
							   DestinationChanged="v => formData.Destination = v" />
				}
				else if (currentStep == 2)
				{
					<ScheduleStep OnBack="() => currentStep = 1"
								  OnNext="() => currentStep = 3"
								  UserType="(int)currentUserType"
								  PickupDate="@formData.PickupDate"
								  PickupDateChanged="v => formData.PickupDate = v"
								  DeliveryDate="@formData.DeliveryDate"
								  DeliveryDateChanged="v => formData.DeliveryDate = v" />
				}
				else if (currentStep == 3)
				{
					<TypeStep OnBack="() => currentStep = 2"
							  OnNext="() => currentStep = 4"
							  UserType="(int)currentUserType"
							  TruckType="@formData.TruckType"
							  TruckTypeChanged="v => formData.TruckType = v"
							  LoadType="@formData.LoadType"
							  LoadTypeChanged="v => formData.LoadType = v" />
				}
				else if (currentStep == 4)
				{
					<DetailsStep OnBack="() => currentStep = 3"
								 OnSubmit="HandleSubmit"
								 UserType="(int)currentUserType"
								 FormData="formData" />
				}
				else if (currentStep == 5)
				{
					<ConfirmationStep UserType="(int)currentUserType"
									  FormData="formData"
									  OnPostAnother="ResetForm"
									  OnViewDashboard="GoToDashboard" />
				}
			</div>

			<!-- Map - Right Side -->
			<div class="lg:col-span-2 order-first lg:order-last mb-6 lg:mb-0">
				<div class="lg:sticky lg:top-8">
					<MapPreview Origin="@formData.Origin" Destination="@formData.Destination" />
				</div>
			</div>
		</div>
	</div>
</div>

@code {
	private enum UserType { Driver, Shipper }

	private UserType currentUserType = UserType.Driver;
	private int currentStep = 1;

	private AvailabilityFormData formData = new();

	private void SetUserType(UserType type)
	{
		currentUserType = type;
		currentStep = 1;
	}

	private void HandleSubmit()
	{
		// TODO: Save to database via service
		Console.WriteLine($"Posting availability: {currentUserType}");
		currentStep = 5;
	}

	private void ResetForm()
	{
		currentStep = 1;
		formData = new();
	}

	private void GoToDashboard()
	{
		Navigation.NavigateTo("/dashboard");
	}

	private void GoBack()
	{
		Navigation.NavigateTo("/dashboard");
	}
}
